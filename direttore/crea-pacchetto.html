<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Creazione Pacchetto Lezioni</title>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
  <link rel="stylesheet" href="../assets/css/style.css" />
</head>
  
<body>
  <h1>Creazione Pacchetto Lezioni</h1>
  <form id="pacchettoForm">
    <label for="nomePacchetto">Nome Pacchetto:</label>
    <input type="text" id="nomePacchetto" required><br><br>

    <label for="dataLezione">Data Lezione:</label>
    <input type="date" id="dataLezione" required><br><br>

    <button type="submit">Salva Pacchetto</button>
  </form>

  <script>
    // Configurazione Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyBVcNJhXiytEKBtC09T3kbykVzAY0AHZmM",
      authDomain: "rari-nantes-tesserati.firebaseapp.com",
      projectId: "rari-nantes-tesserati",
      storageBucket: "rari-nantes-tesserati.appspot.com",
      messagingSenderId: "435337228811",
      appId: "1:435337228811:web:a5f1fd0fb9e17bfbc00d0e"
    };

    // Inizializza Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // Controllo autenticazione e ruolo
    auth.onAuthStateChanged(user => {
      if (user) {
        // Recupera il ruolo dell'utente
        db.collection("utenti").doc(user.uid).get().then(doc => {
          if (doc.exists) {
            const ruolo = doc.data().ruolo;
            if (ruolo === "admin" || ruolo === "direttore") {
              // Mostra il form
              document.getElementById("pacchettoForm").style.display = "block";
            } else {
              alert("Accesso negato: solo admin o direttore possono creare pacchetti.");
            }
          } else {
            alert("Utente non trovato nel database.");
          }
        });
      } else {
        alert("Utente non autenticato.");
      }
    });

    // Gestione invio form
    document.getElementById("pacchettoForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const nomePacchetto = document.getElementById("nomePacchetto").value;
      const dataLezione = document.getElementById("dataLezione").value;

      db.collection("pacchetti").add({
        nome: nomePacchetto,
        data: dataLezione
      })
      .then(() => {
        alert("Pacchetto salvato con successo!");
        document.getElementById("pacchettoForm").reset();
      })
      .catch(error => {
        console.error("Errore nel salvataggio: ", error);
      });
    });
  </script>
</body>
</html>
